<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/styles.c6e01653faa15eb2f958.css">body{background:beige;font-family:Verdana,sans-serif;margin:0 auto;width:900px}a{text-decoration:none}.header-module--header-box--1n71v{background:beige;background-image:radial-gradient(#ada 50%,transparent 0),radial-gradient(#ada 50%,transparent 0);background-position:0 0,10px 10px;background-size:20px 20px;box-sizing:border-box;padding:15px}.header-module--header-title--3bG6m{margin:unset}.header-module--header-desc--16eqr{margin:unset;margin-top:10px;margin-left:10px}.header-module--header-link--iaIxD{color:#000}.header-module--header-link--iaIxD:active:,.header-module--header-link--iaIxD:hover,.header-module--header-link--iaIxD:link,.header-module--header-link--iaIxD:visited{color:#000}.main-module--flex--3TU8Y{display:flex}.main-module--main-left--3DDK-{padding:10px;width:65%;min-width:585px}.main-module--main-right--1fO1v{margin:0 0 0 50px;padding:10px;width:35%}.sidebar-module--sidebar-topic--1SwSv{margin:unset}.sidebar-module--sidebar-ul--3mAfD{margin-top:8px;list-style:none}.sidebar-module--twitter-logo--1ISZj{width:24px;height:24px;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApLS0+PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNDAwIDQwMCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDAwIDQwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHN0eWxlIHR5cGU9InRleHQvY3NzIj4uc3Qwe2ZpbGw6IzFEQTFGMjt9IC5zdDF7ZmlsbDojRkZGRkZGO308L3N0eWxlPjxnIGlkPSJEYXJrX0JsdWUiPjxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjIwMCIgY3k9IjIwMCIgcj0iMjAwIi8+PC9nPjxnIGlkPSJMb2dvX194MjAxNF9fRklYRUQiPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0xNjMuNCwzMDUuNWM4OC43LDAsMTM3LjItNzMuNSwxMzcuMi0xMzcuMmMwLTIuMSwwLTQuMi0wLjEtNi4yYzkuNC02LjgsMTcuNi0xNS4zLDI0LjEtMjUKCQljLTguNiwzLjgtMTcuOSw2LjQtMjcuNyw3LjZjMTAtNiwxNy42LTE1LjQsMjEuMi0yNi43Yy05LjMsNS41LTE5LjYsOS41LTMwLjYsMTEuN2MtOC44LTkuNC0yMS4zLTE1LjItMzUuMi0xNS4yCgkJYy0yNi42LDAtNDguMiwyMS42LTQ4LjIsNDguMmMwLDMuOCwwLjQsNy41LDEuMywxMWMtNDAuMS0yLTc1LjYtMjEuMi05OS40LTUwLjRjLTQuMSw3LjEtNi41LDE1LjQtNi41LDI0LjIKCQljMCwxNi43LDguNSwzMS41LDIxLjUsNDAuMWMtNy45LTAuMi0xNS4zLTIuNC0yMS44LTZjMCwwLjIsMCwwLjQsMCwwLjZjMCwyMy40LDE2LjYsNDIuOCwzOC43LDQ3LjNjLTQsMS4xLTguMywxLjctMTIuNywxLjcKCQljLTMuMSwwLTYuMS0wLjMtOS4xLTAuOWM2LjEsMTkuMiwyMy45LDMzLjEsNDUsMzMuNWMtMTYuNSwxMi45LTM3LjMsMjAuNi01OS45LDIwLjZjLTMuOSwwLTcuNy0wLjItMTEuNS0wLjcKCQlDMTEwLjgsMjk3LjUsMTM2LjIsMzA1LjUsMTYzLjQsMzA1LjUiLz48L2c+PC9zdmc+)}.sidebar-module--sidebar-hr--1UsP9{border:0;border-top:1px dashed grey}.index-module--index-box--OSpkn{margin:unset}.index-module--index-date--1Fkmx{margin:unset;font-size:12px;text-align:right}.index-module--index-title--1fWNR{background:khaki;padding:8px;border-radius:4px;margin:unset}.index-module--index-link--3KOWZ,.index-module--index-link--3KOWZ:link,.index-module--index-link--3KOWZ:visited{color:#000}.index-module--index-link--3KOWZ:active,.index-module--index-link--3KOWZ:hover{color:red}.blog-post-module--blog-post-title--2LYkW{background:khaki;padding:8px;border-radius:4px;margin:unset;height:28px}.blog-post-module--blog-post-date--3l9Tb{font-size:12px;text-align:right;margin:unset;margin-top:2px}.blog-post-module--blog-post-tags--200i0{list-style-type:none;margin:unset;padding:unset}.blog-post-module--blog-post-tag--2CXnx{margin:unset;margin-right:10px;padding:4px;display:inline;background:#deb887;border-radius:4px}.fixed-page-module--fixed-page-title--1hyOH{background:khaki;padding:8px;border-radius:4px;margin:unset;height:28px}.fixed-page-module--fixed-page-date--2GfCH{margin:unset;margin-top:2px;font-size:12px;text-align:right}.tags-module--tags-date--3wOac{margin:unset;font-size:12px;text-align:right}.tags-module--tags-title--VuE9d{background:khaki;padding:8px;border-radius:4px;margin:unset;height:28px}.tags-module--tags-link--F3nDB{color:#000}.tags-module--tags-link--F3nDB:active:,.tags-module--tags-link--F3nDB:hover,.tags-module--tags-link--F3nDB:link,.tags-module--tags-link--F3nDB:visited{color:#000}</style><meta name="generator" content="Gatsby 2.21.10"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/blog/webpack-runtime-62d7ff5756a0837d4978.js"/><link as="script" rel="preload" href="/blog/framework-20ef01989315425214b5.js"/><link as="script" rel="preload" href="/blog/app-2a6e38a0cf031f2a57f5.js"/><link as="script" rel="preload" href="/blog/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/blog/component---src-templates-tags-jsx-873f5af64e323bfacf6f.js"/><link as="fetch" rel="preload" href="/blog/page-data/tag/gcp/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header><div class="header-module--header-box--1n71v"><h1 class="header-module--header-title--3bG6m"><a class="header-module--header-link--iaIxD" href="/blog/">yakiniku-teishoku</a></h1><p class="header-module--header-desc--16eqr">日々の備忘録など</p></div></header><div class="main-module--flex--3TU8Y"><div class="main-module--main-left--3DDK-"><div><h2 class="tags-module--tags-title--VuE9d"><a class="tags-module--tags-link--F3nDB" href="/blog/202005/GCPStartupMemo/">GCPスタートアップ</a></h2><p class="tags-module--tags-date--3wOac">2020年05月09日</p><div><p>趣味用途でならVPSをレンタルするよりもGCPのVMの方が費用が掛からないようだったので
実際に立ててみた時の備忘録です。</p>
<hr>
<h2>VMインスタンス作成する</h2>
<h3>アカウントを以下より登録する</h3>
<p><a href="https://cloud.google.com/">https://cloud.google.com/</a></p>
<ul>
<li>無料トライアルを使用</li>
<li>Google Account/ Credit Cardが必要</li>
</ul>
<h3>プロジェクトを作成</h3>
<p>デフォルトで作成されていたので、それを利用する。</p>
<h3>VMインスタンスを作成</h3>
<ol>
<li>ログイン後の画面左のメニューより「Compute Engine」から「VM インスタンスを作成」を選択</li>
<li>表示される画面から「作成」を選択（少し時間がかかる）</li>
<li>
<p>以下の項目を編集する</p>
<ul>
<li>名前</li>
<li>リージョン(オレゴン、アイオワあたりを選択)</li>
<li>マシン(f1-microを選択)</li>
<li>ディスク(標準永続ディスクで30GBに変更)</li>
<li>OS(Debianを選択)</li>
</ul>
</li>
</ol>
<h2>Google Cloud SDK でインスタンスにSSH接続する</h2>
<h3>作業環境</h3>
<ul>
<li>OS: ArchLinux(64bit)</li>
</ul>
<h3>Google Cloud SDK をインストールする</h3>
<p>参考リンク
<a href="https://cloud.google.com/sdk/docs?hl=ja">https://cloud.google.com/sdk/docs?hl=ja</a></p>
<p>今回の手順は以下の流れで実施。</p>
<ol>
<li>
<p>パッケージをダウンロード/展開</p>
<pre><code>wget https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-280.0.0-linux-x86_64.tar.gz
tar zxf google-cloud-sdk-280.0.0-linux-x86_64.tar.gz
</code></pre>
</li>
<li>
<p>インストール</p>
<pre><code>./google-cloud-sdk/install.sh
</code></pre>
</li>
<li>
<p>初期化</p>
<pre><code>./google-cloud-sdk/bin/gcloud init
</code></pre>
</li>
</ol>
<h3>gcloud コマンドでSSH接続</h3>
<p>gcloudコマンドで接続するためのコマンドはVMインスタンスの管理画面から「接続」-「gcloudコマンドを表示」から確認できる</p>
<h2>インスタンス内の接続設定をする</h2>
<p>gcloud ssh コマンドで接続している状態で実施する。</p>
<h3>sshのポートを変更する</h3>
<ol>
<li>
<p>sshdのポートを変更する</p>
<pre><code>sudo cp -p /etc/ssh/sshd_config /etc/ssh/sshd_config.org
sudo vi /etc/ssh/sshd_config #portを変更
sudo systemctl restart sshd
</code></pre>
</li>
<li>
<p>Firewall(GCP側の設定)を変更後のSSHポートに合わせる
以下のファイアウォール設定をWebで変更する</p>
<ul>
<li>default-allow-ssh</li>
</ul>
</li>
<li>
<p>gcloud ssh コマンドの接続ポート指定を行う
これまでに実行しているgcloud sshコマンドに以下のオプションを追加する</p>
<pre><code>--ssh-flag="-p ポート"
</code></pre>
</li>
</ol>
<pre><code></code></pre></div></div></div><div class="main-module--main-right--1fO1v"><div><a href="https://twitter.com/nn70010666"><div class="sidebar-module--twitter-logo--1ISZj"></div></a><hr class="sidebar-module--sidebar-hr--1UsP9"/><h3 class="sidebar-module--sidebar-topic--1SwSv">このページについて</h3><ul class="sidebar-module--sidebar-ul--3mAfD"><li><a href="/blog/aboutThisPage/">このブログについて</a></li><li><a href="/blog/author/">自己紹介</a></li></ul></div><div><h3 class="sidebar-module--sidebar-topic--1SwSv">最近の投稿</h3><ul class="sidebar-module--sidebar-ul--3mAfD"><li><a href="/blog/202005/GCPStartupMemo/">GCPスタートアップ</a></li><li><a href="/blog/hello-world/">Hello World</a></li></ul></div><div><h3 class="sidebar-module--sidebar-topic--1SwSv">タグ別記事</h3><ul class="sidebar-module--sidebar-ul--3mAfD"><li><a href="/blog/tag/gcp">gcp</a>(<!-- -->1<!-- -->)</li><li><a href="/blog/tag/tech">tech</a>(<!-- -->1<!-- -->)</li><li><a href="/blog/tag/test">test</a>(<!-- -->1<!-- -->)</li></ul></div></div></div><hr/><a href="https://www.gatsbyjs.org/">Powered by Gatsbyjs</a></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-165969785-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/tag/gcp/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-2a6e38a0cf031f2a57f5.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-55c6a2bf15a4c89678e8.js"],"component---src-templates-blog-post-jsx":["/component---src-templates-blog-post-jsx-b01bbfdeef27b3c0320f.js"],"component---src-templates-fixed-page-jsx":["/component---src-templates-fixed-page-jsx-f78e9ca321dabdd4685a.js"],"component---src-templates-tags-jsx":["/component---src-templates-tags-jsx-873f5af64e323bfacf6f.js"]};/*]]>*/</script><script src="/blog/component---src-templates-tags-jsx-873f5af64e323bfacf6f.js" async=""></script><script src="/blog/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/blog/app-2a6e38a0cf031f2a57f5.js" async=""></script><script src="/blog/framework-20ef01989315425214b5.js" async=""></script><script src="/blog/webpack-runtime-62d7ff5756a0837d4978.js" async=""></script></body></html>